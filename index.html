<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar/dist/mindar-image-aframe.prod.js"></script>
    <style>
      body, html { margin: 0; padding: 0; overflow: hidden; }
    </style>
  </head>
  <body>
    <a-scene mindar-image="imageTargetSrc: ./target.mind;" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
      <a-assets>
        <a-asset-item id="model" src="https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models/2.0/Duck/glTF/Duck.gltf"></a-asset-item>
      </a-assets>

        <!-- Camera + Cursor - CHANGED: added fuse="true" for mobile -->
        <a-camera position="0 0 0">
            <a-cursor fuse="true" fuse-timeout="1500" raycaster="objects: .clickable"></a-cursor>
          </a-camera>

          <a-entity mindar-image-target="targetIndex: 0">
            <a-gltf-model rotation="0 0 0" position="0 -0.25 0" scale="0.5 0.5 0.5" src="#model"></a-gltf-model>
          
            <!-- Button -->
            <a-plane id="saveContactBtn"
                     position="0 -0.6 0"
                     width="1" height="0.3"
                     color="blue"
                     text="value: Save Contact; align: center; color: white"
                     clickable-button>
            </a-plane>
          </a-entity>
    </a-scene>
  </body>
  
  <script>
    AFRAME.registerComponent('clickable-button', {
      init: function () {
        const el = this.el;
    
        // Mobile touch listener
        el.addEventListener('touchstart', (e) => {
          e.preventDefault();
          triggerDownload(el);
        });
    
        // Desktop click listener
        el.addEventListener('click', (e) => {
          triggerDownload(el);
        });
    
        function triggerDownload(btn) {
          // Visual feedback
          btn.setAttribute('color', 'green');
    
          const vCardData = `BEGIN:VCARD
    VERSION:3.0
    FN:Your Name
    ORG:Your Company
    EMAIL:your.email@example.com
    TEL:+1234567890
    END:VCARD`;
    
          const blob = new Blob([vCardData], { type: 'text/vcard' });
          const url = URL.createObjectURL(blob);
    
          const a = document.createElement('a');
          a.href = url;
          a.download = 'contact.vcf';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
    
          // Reset button color after 2s
          setTimeout(() => {
            btn.setAttribute('color', 'blue');
          }, 2000);
        }
      }
    });
    </script>
  
  </html>